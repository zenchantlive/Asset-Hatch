{
  "reward": {
    "type": "xlm"
  },
  "sourcedFromGithub": false,
  "githubAsSourceMeta": null,
  "isAnonymous": false,
  "coverImage": "",
  "autoGeneratedCover": "",
  "hasPolls": false,
  "totalPollVotes": 0,
  "upvotes": 0,
  "downvotes": 0,
  "untaggedFrom": [],
  "upvotedBy": [],
  "downvotedBy": [],
  "responses": [],
  "followers": [],
  "answeredByTarget": false,
  "inviters": [],
  "duplicatePosts": [],
  "hasReward": false,
  "bookmarkedIn": [],
  "similarPostIds": [],
  "reactionsByCurrentUser": [],
  "toc": [],
  "_id": "695acb5a2df78b9097009068",
  "createdAt": "2026-01-04T20:19:38.908Z",
  "updatedAt": "2026-01-04T21:06:03.248Z",
  "views": 2,
  "isActive": true,
  "hasLatex": true,
  "popularity": 7967.7062,
  "discussionScore": 0,
  "enableToc": false,
  "type": "story",
  "partOfPublication": true,
  "responseCount": 0,
  "replyCount": 0,
  "isFeatured": false,
  "isEngaging": false,
  "isDelisted": false,
  "isNotified": false,
  "numCollapsed": 0,
  "reactions": [],
  "totalReactions": 0,
  "totalReactionsByCurrentUser": 0,
  "isPinnedToBlog": false,
  "disableComments": false,
  "commentsPaused": false,
  "syncAlgolia": false,
  "numUniqueUsersWhoReacted": 0,
  "slugOverridden": true,
  "tweetOptions": {
    "enabled": false
  },
  "title": "Part 3: The Crisis - When Frameworks Fail",
  "cuid": "cmk06dt7f000602js8shw80i6",
  "dateAdded": "2026-01-04T20:19:38.907Z",
  "isCoverAttributionHidden": false,
  "stickCoverToBottom": false,
  "slug": "part-3-the-crisis-when-frameworks-fail",
  "content": "<h1 id=\"heading-part-3-the-crisis-when-frameworks-fail\">Part 3: The Crisis - When Frameworks Fail</h1>\n<p><strong>Previously:</strong> Built a beautiful chat interface with CopilotKit. Cosmic UI looking sharp. Memory system in place. Everything seems great.</p>\n<p><strong>Now:</strong> Nothing works and I'm 4 hours into debugging hell.</p>\n<h2 id=\"heading-the-morning-after\">The Morning After</h2>\n<p>December 26th, 8:47 AM. Coffee in hand. Ready to implement Slice 04: the <code>updateQuality</code> tool that lets the AI agent actually set project parameters.</p>\n<p>Should be simple, right? CopilotKit's docs show:</p>\n<pre><code class=\"lang-typescript\">useCopilotAction({\n  name: <span class=\"hljs-string\">'updateQuality'</span>,\n  parameters: [\n    { name: <span class=\"hljs-string\">'qualityKey'</span>, <span class=\"hljs-keyword\">type</span>: <span class=\"hljs-string\">'string'</span> },\n    { name: <span class=\"hljs-string\">'value'</span>, <span class=\"hljs-keyword\">type</span>: <span class=\"hljs-string\">'string'</span> }\n  ],\n  handler: <span class=\"hljs-keyword\">async</span> ({ qualityKey, value }) =&gt; {\n    <span class=\"hljs-comment\">// Update database</span>\n    <span class=\"hljs-comment\">// Return success message</span>\n  }\n});\n</code></pre>\n<p>Clean API. Clear example. I implement it exactly as documented.</p>\n<h2 id=\"heading-attempt-1-by-the-book\">Attempt #1: By The Book</h2>\n<pre><code class=\"lang-typescript\"><span class=\"hljs-comment\">// hooks/usePlanningTools.ts</span>\n<span class=\"hljs-keyword\">import</span> { useCopilotAction } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@copilotkit/react-core'</span>;\n<span class=\"hljs-keyword\">import</span> { db } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/lib/db'</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">usePlanningTools</span>(<span class=\"hljs-params\">projectId: <span class=\"hljs-built_in\">string</span></span>) </span>{\n  useCopilotAction({\n    name: <span class=\"hljs-string\">'updateQuality'</span>,\n    description: <span class=\"hljs-string\">'Update a specific quality parameter for the project'</span>,\n    parameters: [\n      {\n        name: <span class=\"hljs-string\">'qualityKey'</span>,\n        <span class=\"hljs-keyword\">type</span>: <span class=\"hljs-string\">'string'</span>,\n        description: <span class=\"hljs-string\">'The quality to update (art_style, perspective, etc.)'</span>,\n        required: <span class=\"hljs-literal\">true</span>,\n      },\n      {\n        name: <span class=\"hljs-string\">'value'</span>,\n        <span class=\"hljs-keyword\">type</span>: <span class=\"hljs-string\">'string'</span>,\n        description: <span class=\"hljs-string\">'The new value to set'</span>,\n        required: <span class=\"hljs-literal\">true</span>,\n      },\n    ],\n    handler: <span class=\"hljs-keyword\">async</span> ({ qualityKey, value }) =&gt; {\n      <span class=\"hljs-keyword\">await</span> db.projects.update(projectId, {\n        [qualityKey]: value,\n        updated_at: <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>().toISOString(),\n      });\n\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`Successfully updated <span class=\"hljs-subst\">${qualityKey}</span> to \"<span class=\"hljs-subst\">${value}</span>\"`</span>;\n    },\n  });\n}\n</code></pre>\n<p>I add it to the planning page:</p>\n<pre><code class=\"lang-typescript\"><span class=\"hljs-comment\">// app/project/[id]/planning/page.tsx</span>\n<span class=\"hljs-string\">'use client'</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">PlanningPage</span>(<span class=\"hljs-params\">{ params }: { params: { id: <span class=\"hljs-built_in\">string</span> } }</span>) </span>{\n  usePlanningTools(params.id);  <span class=\"hljs-comment\">// Register tools</span>\n\n  <span class=\"hljs-keyword\">return</span> (\n    &lt;div&gt;\n      &lt;ChatInterface /&gt;\n      {<span class=\"hljs-comment\">/* ... */</span>}\n    &lt;/div&gt;\n  );\n}\n</code></pre>\n<p><strong>Test:</strong></p>\n<pre><code class=\"lang-markdown\">Me: \"Let's use pixel art style\"\n\nAI: \"Great! I'll set the art style to Pixel Art.\"\n<span class=\"hljs-code\">    [Thinking...]\n    \"I've updated the art_style to 'Pixel Art'.\"</span>\n</code></pre>\n<p>[Check database]</p>\n<pre><code class=\"lang-sql\"><span class=\"hljs-keyword\">SELECT</span> art_style <span class=\"hljs-keyword\">FROM</span> projects <span class=\"hljs-keyword\">WHERE</span> <span class=\"hljs-keyword\">id</span> = <span class=\"hljs-string\">'...'</span>;\n<span class=\"hljs-comment\">-- Result: NULL</span>\n</code></pre>\n<p><strong>Nothing happened.</strong></p>\n<h2 id=\"heading-attempt-2-add-logging\">Attempt #2: Add Logging</h2>\n<p>Maybe the handler isn't being called? Add console.logs:</p>\n<pre><code class=\"lang-typescript\">handler: <span class=\"hljs-keyword\">async</span> ({ qualityKey, value }) =&gt; {\n  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">'üîß updateQuality called:'</span>, { qualityKey, value });\n\n  <span class=\"hljs-keyword\">await</span> db.projects.update(projectId, {\n    [qualityKey]: value,\n    updated_at: <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>().toISOString(),\n  });\n\n  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">'‚úÖ Database updated'</span>);\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`Successfully updated <span class=\"hljs-subst\">${qualityKey}</span> to \"<span class=\"hljs-subst\">${value}</span>\"`</span>;\n},\n</code></pre>\n<p><strong>Test again:</strong></p>\n<pre><code class=\"lang-markdown\">Me: \"Set perspective to top-down\"\n\nAI: [Response about updating perspective]\n</code></pre>\n<p>[Check console]</p>\n<p><strong>No logs. Handler never ran.</strong></p>\n<p>The AI was <em>saying</em> it called the tool, but the handler wasn't executing.</p>\n<h2 id=\"heading-attempt-3-check-message-logs\">Attempt #3: Check Message Logs</h2>\n<p>Maybe the tool call is happening but failing silently? Check CopilotKit's message stream:</p>\n<pre><code class=\"lang-typescript\"><span class=\"hljs-keyword\">const</span> { messages, appendMessage } = useCopilotChat();\n\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">'Messages:'</span>, messages);\n</code></pre>\n<p>Output:</p>\n<pre><code class=\"lang-javascript\">[\n  { <span class=\"hljs-attr\">role</span>: <span class=\"hljs-string\">'user'</span>, <span class=\"hljs-attr\">content</span>: <span class=\"hljs-string\">'Set perspective to top-down'</span>, ... },\n  {\n    <span class=\"hljs-attr\">role</span>: <span class=\"hljs-string\">'assistant'</span>,\n    <span class=\"hljs-attr\">content</span>: <span class=\"hljs-string\">'I'</span>ve updated the perspective...<span class=\"hljs-string\">',\n    isResultMessage: [Function], // ??? What is this?\n  }\n]</span>\n</code></pre>\n<p><strong>Wait.</strong> <code>isResultMessage</code> is a function on the message object?</p>\n<p>That's weird. But the docs don't mention anything about it, so I ignore it.</p>\n<p><strong>Mistake #1:</strong> Ignoring weird framework behavior.</p>\n<h2 id=\"heading-attempt-4-try-appendmessage-api\">Attempt #4: Try appendMessage API</h2>\n<p>Maybe I need to manually trigger tool execution? CopilotKit has an <code>appendMessage</code> function:</p>\n<pre><code class=\"lang-typescript\"><span class=\"hljs-keyword\">const</span> { appendMessage } = useCopilotChat();\n\n<span class=\"hljs-comment\">// Manually append a tool call message?</span>\nappendMessage({\n  role: <span class=\"hljs-string\">'assistant'</span>,\n  content: <span class=\"hljs-string\">''</span>,\n  toolCalls: [{\n    id: <span class=\"hljs-string\">'call_1'</span>,\n    <span class=\"hljs-keyword\">type</span>: <span class=\"hljs-string\">'function'</span>,\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>: </span>{\n      name: <span class=\"hljs-string\">'updateQuality'</span>,\n      <span class=\"hljs-built_in\">arguments</span>: <span class=\"hljs-built_in\">JSON</span>.stringify({ qualityKey: <span class=\"hljs-string\">'art_style'</span>, value: <span class=\"hljs-string\">'Pixel Art'</span> })\n    }\n  }]\n});\n</code></pre>\n<p><strong>Browser console:</strong></p>\n<pre><code class=\"lang-markdown\">TypeError: message.isResultMessage is not a function\n<span class=\"hljs-code\">    at processMessages (copilotkit/runtime/src/utils.ts:147)\n    at streamHttpServerResponse (copilotkit/runtime/src/server.ts:89)</span>\n</code></pre>\n<p><strong>THERE IT IS.</strong></p>\n<p>The error I'd been dreading. The one that would consume my day.</p>\n<h2 id=\"heading-the-debugging-marathon\">The Debugging Marathon</h2>\n<h3 id=\"heading-hour-1-read-copilotkit-source\">Hour 1: Read CopilotKit Source</h3>\n<p>I clone the CopilotKit repo. Search for <code>isResultMessage</code>:</p>\n<pre><code class=\"lang-typescript\"><span class=\"hljs-comment\">// @copilotkit/runtime/src/utils.ts</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">processMessages</span>(<span class=\"hljs-params\">messages: Message[]</span>) </span>{\n  <span class=\"hljs-keyword\">return</span> messages.filter(<span class=\"hljs-function\"><span class=\"hljs-params\">msg</span> =&gt;</span> !msg.isResultMessage());\n  <span class=\"hljs-comment\">//                                 ^^^^^^^^^^^^^^^^</span>\n  <span class=\"hljs-comment\">//                                 Assumes this exists and is a function</span>\n}\n</code></pre>\n<p>But in the client code, messages don't have this method. They're plain objects from the API.</p>\n<p><strong>Framework bug confirmed.</strong></p>\n<h3 id=\"heading-hour-2-search-github-issues\">Hour 2: Search GitHub Issues</h3>\n<p>Find Issue #465:</p>\n<blockquote>\n<p><strong>Title:</strong> <code>appendMessage</code> causes \"isResultMessage is not a function\" error</p>\n<p><strong>Status:</strong> Open <strong>Labels:</strong> bug, v1.50.x <strong>Comments:</strong> 14 people reporting same issue</p>\n</blockquote>\n<p>PR #2260:</p>\n<blockquote>\n<p><strong>Title:</strong> Migrate from <code>appendMessage</code> to <code>sendMessage</code></p>\n<p><strong>Status:</strong> Merged to main, not released <strong>Description:</strong> <code>appendMessage</code> deprecated, use <code>sendMessage</code> instead. Internal message format changed.</p>\n</blockquote>\n<p><strong>Translation:</strong> CopilotKit v1.50.1 is broken. The fix exists but isn't published yet.</p>\n<h3 id=\"heading-hour-3-try-downgrading\">Hour 3: Try Downgrading</h3>\n<p>Maybe v1.49.0 works?</p>\n<pre><code class=\"lang-bash\">bun add @copilotkit/react-core@1.49.0 @copilotkit/runtime@1.49.0\n</code></pre>\n<p><strong>Result:</strong> Different error. v1.49 doesn't have OpenRouter support.</p>\n<h3 id=\"heading-hour-4-try-pre-release\">Hour 4: Try Pre-release</h3>\n<p>Maybe the fix is in beta?</p>\n<pre><code class=\"lang-bash\">bun add @copilotkit/react-core@next @copilotkit/runtime@next\n</code></pre>\n<p><strong>Result:</strong> <code>next</code> tag doesn't exist. No beta channel.</p>\n<h2 id=\"heading-the-moment-of-truth\">The Moment of Truth</h2>\n<p>It's now 1:15 PM. I've been debugging for 4+ hours. I have two choices:</p>\n<p><strong>Option A: Wait for CopilotKit fix</strong></p>\n<ul>\n<li><p>Unknown timeline (could be days, could be weeks)</p>\n</li>\n<li><p>Blocks all feature development</p>\n</li>\n<li><p>Keeps me dependent on a framework with a small team</p>\n</li>\n</ul>\n<p><strong>Option B: Rip out CopilotKit, migrate to a different AI SDK</strong></p>\n<ul>\n<li><p>2-3 hours of migration work (estimate)</p>\n</li>\n<li><p>Back to working state by end of day</p>\n</li>\n<li><p>Switch to more mature, actively maintained SDK</p>\n</li>\n</ul>\n<p>The sunk cost fallacy is screaming at me: \"But you already spent 6 hours integrating CopilotKit! The cosmic UI is built around it! You'll have to rewrite everything!\"</p>\n<h2 id=\"heading-the-decision-framework\">The Decision Framework</h2>\n<p>When frameworks fail you, ask these questions:</p>\n<h3 id=\"heading-1-is-this-a-configuration-issue-or-a-framework-bug\">1. Is this a configuration issue or a framework bug?</h3>\n<p><strong>Answer:</strong> Framework bug. Verified in source code and GitHub issues.</p>\n<h3 id=\"heading-2-can-i-work-around-it\">2. Can I work around it?</h3>\n<p><strong>Answer:</strong> No. Tool execution is core to the product. Can't ship without it.</p>\n<h3 id=\"heading-3-is-a-fix-coming-soon\">3. Is a fix coming soon?</h3>\n<p><strong>Answer:</strong> Unknown. Issue is open with no milestone. Could be days, could be weeks.</p>\n<h3 id=\"heading-4-whats-the-migration-cost\">4. What's the migration cost?</h3>\n<p><strong>Answer:</strong> Estimated 2-3 hours. All the UI can stay. Just swap the chat hook and API route.</p>\n<h3 id=\"heading-5-whats-the-cost-of-waiting\">5. What's the cost of waiting?</h3>\n<p><strong>Answer:</strong> Entire project blocked. Can't work on any subsequent slices.</p>\n<h3 id=\"heading-6-whats-the-opportunity-cost\">6. What's the opportunity cost?</h3>\n<p><strong>Answer:</strong> If I migrate now, I'm back to building features today. If I wait, I waste days in limbo.</p>\n<h2 id=\"heading-the-pivot-decision\">The Pivot Decision</h2>\n<p>1:47 PM. I make the call.</p>\n<p><strong>We're migrating to Vercel AI SDK.</strong></p>\n<h3 id=\"heading-why-vercel-ai-sdk\">Why Vercel AI SDK?</h3>\n<p><strong>Pros:</strong></p>\n<ul>\n<li><p>‚úÖ Industry standard (2M+ weekly npm downloads)</p>\n</li>\n<li><p>‚úÖ Maintained by Vercel (fast bug fixes, active development)</p>\n</li>\n<li><p>‚úÖ Official OpenRouter integration (<code>@openrouter/ai-sdk-provider</code>)</p>\n</li>\n<li><p>‚úÖ Comprehensive docs (<a target=\"_blank\" href=\"http://ai.sdk.dev\">ai.sdk.dev</a>, Academy courses, 50+ examples)</p>\n</li>\n<li><p>‚úÖ Better type safety (Zod schemas for tools)</p>\n</li>\n<li><p>‚úÖ Smaller bundle (95KB vs 180KB)</p>\n</li>\n<li><p>‚úÖ Next.js 16 optimized</p>\n</li>\n</ul>\n<p><strong>Cons:</strong></p>\n<ul>\n<li><p>‚ùå 2-3 hours of migration work</p>\n</li>\n<li><p>‚ùå Have to learn new API patterns</p>\n</li>\n<li><p>‚ùå Can't reuse CopilotKit-specific code</p>\n</li>\n<li><p>‚ùå Invalidates ADR-001 (previous architectural decision)</p>\n</li>\n</ul>\n<p><strong>Neutral:</strong></p>\n<ul>\n<li><p>Same capabilities (tool calling, streaming, context)</p>\n</li>\n<li><p>Lower-level API (more control but more code)</p>\n</li>\n<li><p>No pre-built UI components (but I built custom UI anyway)</p>\n</li>\n</ul>\n<h2 id=\"heading-the-emotional-side\">The Emotional Side</h2>\n<p>Making this decision <em>sucked</em>.</p>\n<p>It felt like admitting failure. I'd chosen CopilotKit carefully. I'd defended that choice in documentation. I'd built around it.</p>\n<p>But here's the thing about solo development: <strong>ego is expensive.</strong></p>\n<p>Stubbornness has a cost measured in days. Being \"right\" about your initial framework choice doesn't matter if you can't ship.</p>\n<h3 id=\"heading-the-mantra\">The Mantra</h3>\n<p>I wrote this in my notes:</p>\n<blockquote>\n<p>\"Ship fast, pivot faster. The only unforgivable mistake is staying stuck.\"</p>\n</blockquote>\n<p>Then I started deleting code.</p>\n<h2 id=\"heading-what-i-learned\">What I Learned</h2>\n<p><strong>1. Framework lock-in is real</strong></p>\n<p>Even \"simple\" integrations create dependency trees that make migration painful.</p>\n<p><strong>2. Small teams = higher risk</strong></p>\n<p>CopilotKit is built by a small team. One breaking bug can block their entire user base for weeks.</p>\n<p><strong>3. GitHub Issues are underrated</strong></p>\n<p>I should've checked Issues <em>before</em> choosing the framework, not after it broke.</p>\n<p><strong>4. Community size matters</strong></p>\n<p>Vercel AI SDK has 100x more users. More users = more eyes on bugs = faster fixes.</p>\n<p><strong>5. Sunk cost is a trap</strong></p>\n<p>4 hours of debugging is already lost. Don't lose 40 more hours to stubbornness.</p>\n<p><strong>6. \"By the book\" fails when the book is wrong</strong></p>\n<p>Following docs perfectly doesn't help when the framework has fundamental bugs.</p>\n<h2 id=\"heading-the-commit-that-closed-this-chapter\">The Commit That Closed This Chapter</h2>\n<pre><code class=\"lang-bash\">commit c59879c\nDate: Dec 26, 2025 - 2:03 PM\n\nchore: Add supporting files and configuration\n<span class=\"hljs-comment\"># Last commit before migration begins</span>\n</code></pre>\n<p>By 2:15 PM, I'd made the decision.</p>\n<p>By 5:30 PM, the migration would be complete and tools would be working.</p>\n<p>But that's a story for the next post.</p>\n<hr />\n<h2 id=\"heading-technical-post-mortem\">Technical Post-Mortem</h2>\n<h3 id=\"heading-what-went-wrong\">What Went Wrong</h3>\n<p><strong>Root Cause:</strong> CopilotKit v1.50.1 has a bug where <code>appendMessage()</code> passes messages without the <code>isResultMessage()</code> method, but the runtime expects it.</p>\n<p><strong>Contributing Factors:</strong></p>\n<ul>\n<li><p>Small framework team (slower response to bugs)</p>\n</li>\n<li><p>No beta channel for testing pre-release fixes</p>\n</li>\n<li><p>Deprecation handled poorly (new <code>sendMessage</code> API not fully working)</p>\n</li>\n</ul>\n<h3 id=\"heading-warning-signs-i-missed\">Warning Signs I Missed</h3>\n<ol>\n<li><p><strong>\"AI agents in 5 minutes\"</strong> ‚Äî Too good to be true</p>\n</li>\n<li><p><strong>Small npm download count</strong> ‚Äî Less than 10K/week</p>\n</li>\n<li><p><strong>Recent major version bump</strong> ‚Äî v1.50 was only 2 weeks old</p>\n</li>\n<li><p><strong>Limited Stack Overflow presence</strong> ‚Äî Few answered questions</p>\n</li>\n</ol>\n<h3 id=\"heading-what-id-do-differently\">What I'd Do Differently</h3>\n<ol>\n<li><p><strong>Check GitHub Issues before adoption</strong> ‚Äî Open issues count matters</p>\n</li>\n<li><p><strong>Build POC before full integration</strong> ‚Äî Test tool execution specifically</p>\n</li>\n<li><p><strong>Have migration plan from day one</strong> ‚Äî \"If X breaks, we switch to Y\"</p>\n</li>\n<li><p><strong>Prefer boring technology</strong> ‚Äî Established SDKs over promising new ones</p>\n</li>\n</ol>\n<hr />\n<h2 id=\"heading-coming-next\">Coming Next</h2>\n<p>In <a target=\"_blank\" href=\"04-the-pivot-vercel-ai-sdk.md\">Part 4: The Pivot</a>, I execute the migration.</p>\n<p>You'll see:</p>\n<ul>\n<li><p>The 3-hour migration process, step by step</p>\n</li>\n<li><p>How Vercel AI SDK v6 actually works</p>\n</li>\n<li><p>The moment tools finally executed</p>\n</li>\n<li><p>What I learned about AI SDK architecture</p>\n</li>\n<li><p>Why this crisis was the best thing that could've happened</p>\n</li>\n</ul>\n<p><strong>Spoiler:</strong> By 5:30 PM, I had working tool execution. By 7:00 PM, I'd learned more about AI SDK internals than I would've in a month of \"happy path\" development.</p>\n<p>Sometimes the best teachers are the frameworks that fail you.</p>\n<hr />\n<p><strong>Commit References:</strong></p>\n<ul>\n<li><p><code>c59879c</code> - Last commit before migration (supporting files)</p>\n</li>\n<li><p><code>b7c72f3</code> - Complete Planning Phase P1 implementation with CopilotKit (broken)</p>\n</li>\n</ul>\n<p><strong>Files That Would Be Deleted:</strong></p>\n<ul>\n<li><p><code>/app/api/copilotkit/route.ts</code> - CopilotKit API route</p>\n</li>\n<li><p><code>/hooks/usePlanningTools.ts</code> - CopilotKit action hooks</p>\n</li>\n<li><p>All imports from <code>@copilotkit/*</code></p>\n</li>\n</ul>\n<p><strong>Debugging Tools Used:</strong></p>\n<ul>\n<li><p>Chrome DevTools Network tab (watch API calls)</p>\n</li>\n<li><p>Console.log debugging (tool handler invocation)</p>\n</li>\n<li><p>CopilotKit source code (GitHub)</p>\n</li>\n<li><p>GitHub Issues search (find known bugs)</p>\n</li>\n</ul>\n<p><strong>Time Spent:</strong></p>\n<ul>\n<li><p>Debugging: 4+ hours</p>\n</li>\n<li><p>Research/decision: 1 hour</p>\n</li>\n<li><p><strong>Total sunk cost:</strong> 5 hours</p>\n</li>\n</ul>\n<hr />\n<p><strong>Previous:</strong> <a target=\"_blank\" href=\"02-first-contact-building-with-ai.md\">‚Üê Part 2: First Contact</a> <strong>Next:</strong> <a target=\"_blank\" href=\"04-the-pivot-vercel-ai-sdk.md\">Part 4: The Pivot ‚Üí</a></p>\n",
  "contentMarkdown": "# Part 3: The Crisis - When Frameworks Fail\n\n**Previously:** Built a beautiful chat interface with CopilotKit. Cosmic UI looking sharp. Memory system in place. Everything seems great.\n\n**Now:** Nothing works and I'm 4 hours into debugging hell.\n\n## The Morning After\n\nDecember 26th, 8:47 AM. Coffee in hand. Ready to implement Slice 04: the `updateQuality` tool that lets the AI agent actually set project parameters.\n\nShould be simple, right? CopilotKit's docs show:\n\n```typescript\nuseCopilotAction({\n  name: 'updateQuality',\n  parameters: [\n    { name: 'qualityKey', type: 'string' },\n    { name: 'value', type: 'string' }\n  ],\n  handler: async ({ qualityKey, value }) => {\n    // Update database\n    // Return success message\n  }\n});\n```\n\nClean API. Clear example. I implement it exactly as documented.\n\n## Attempt #1: By The Book\n\n```typescript\n// hooks/usePlanningTools.ts\nimport { useCopilotAction } from '@copilotkit/react-core';\nimport { db } from '@/lib/db';\n\nexport function usePlanningTools(projectId: string) {\n  useCopilotAction({\n    name: 'updateQuality',\n    description: 'Update a specific quality parameter for the project',\n    parameters: [\n      {\n        name: 'qualityKey',\n        type: 'string',\n        description: 'The quality to update (art_style, perspective, etc.)',\n        required: true,\n      },\n      {\n        name: 'value',\n        type: 'string',\n        description: 'The new value to set',\n        required: true,\n      },\n    ],\n    handler: async ({ qualityKey, value }) => {\n      await db.projects.update(projectId, {\n        [qualityKey]: value,\n        updated_at: new Date().toISOString(),\n      });\n\n      return `Successfully updated ${qualityKey} to \"${value}\"`;\n    },\n  });\n}\n```\n\nI add it to the planning page:\n\n```typescript\n// app/project/[id]/planning/page.tsx\n'use client';\n\nexport default function PlanningPage({ params }: { params: { id: string } }) {\n  usePlanningTools(params.id);  // Register tools\n\n  return (\n    <div>\n      <ChatInterface />\n      {/* ... */}\n    </div>\n  );\n}\n```\n\n**Test:**\n\n```markdown\nMe: \"Let's use pixel art style\"\n\nAI: \"Great! I'll set the art style to Pixel Art.\"\n    [Thinking...]\n    \"I've updated the art_style to 'Pixel Art'.\"\n```\n\n\\[Check database\\]\n\n```sql\nSELECT art_style FROM projects WHERE id = '...';\n-- Result: NULL\n```\n\n**Nothing happened.**\n\n## Attempt #2: Add Logging\n\nMaybe the handler isn't being called? Add console.logs:\n\n```typescript\nhandler: async ({ qualityKey, value }) => {\n  console.log('üîß updateQuality called:', { qualityKey, value });\n\n  await db.projects.update(projectId, {\n    [qualityKey]: value,\n    updated_at: new Date().toISOString(),\n  });\n\n  console.log('‚úÖ Database updated');\n  return `Successfully updated ${qualityKey} to \"${value}\"`;\n},\n```\n\n**Test again:**\n\n```markdown\nMe: \"Set perspective to top-down\"\n\nAI: [Response about updating perspective]\n```\n\n\\[Check console\\]\n\n**No logs. Handler never ran.**\n\nThe AI was *saying* it called the tool, but the handler wasn't executing.\n\n## Attempt #3: Check Message Logs\n\nMaybe the tool call is happening but failing silently? Check CopilotKit's message stream:\n\n```typescript\nconst { messages, appendMessage } = useCopilotChat();\n\nconsole.log('Messages:', messages);\n```\n\nOutput:\n\n```javascript\n[\n  { role: 'user', content: 'Set perspective to top-down', ... },\n  {\n    role: 'assistant',\n    content: 'I've updated the perspective...',\n    isResultMessage: [Function], // ??? What is this?\n  }\n]\n```\n\n**Wait.** `isResultMessage` is a function on the message object?\n\nThat's weird. But the docs don't mention anything about it, so I ignore it.\n\n**Mistake #1:** Ignoring weird framework behavior.\n\n## Attempt #4: Try appendMessage API\n\nMaybe I need to manually trigger tool execution? CopilotKit has an `appendMessage` function:\n\n```typescript\nconst { appendMessage } = useCopilotChat();\n\n// Manually append a tool call message?\nappendMessage({\n  role: 'assistant',\n  content: '',\n  toolCalls: [{\n    id: 'call_1',\n    type: 'function',\n    function: {\n      name: 'updateQuality',\n      arguments: JSON.stringify({ qualityKey: 'art_style', value: 'Pixel Art' })\n    }\n  }]\n});\n```\n\n**Browser console:**\n\n```markdown\nTypeError: message.isResultMessage is not a function\n    at processMessages (copilotkit/runtime/src/utils.ts:147)\n    at streamHttpServerResponse (copilotkit/runtime/src/server.ts:89)\n```\n\n**THERE IT IS.**\n\nThe error I'd been dreading. The one that would consume my day.\n\n## The Debugging Marathon\n\n### Hour 1: Read CopilotKit Source\n\nI clone the CopilotKit repo. Search for `isResultMessage`:\n\n```typescript\n// @copilotkit/runtime/src/utils.ts\nfunction processMessages(messages: Message[]) {\n  return messages.filter(msg => !msg.isResultMessage());\n  //                                 ^^^^^^^^^^^^^^^^\n  //                                 Assumes this exists and is a function\n}\n```\n\nBut in the client code, messages don't have this method. They're plain objects from the API.\n\n**Framework bug confirmed.**\n\n### Hour 2: Search GitHub Issues\n\nFind Issue #465:\n\n> **Title:** `appendMessage` causes \"isResultMessage is not a function\" error\n> \n> **Status:** Open **Labels:** bug, v1.50.x **Comments:** 14 people reporting same issue\n\nPR #2260:\n\n> **Title:** Migrate from `appendMessage` to `sendMessage`\n> \n> **Status:** Merged to main, not released **Description:** `appendMessage` deprecated, use `sendMessage` instead. Internal message format changed.\n\n**Translation:** CopilotKit v1.50.1 is broken. The fix exists but isn't published yet.\n\n### Hour 3: Try Downgrading\n\nMaybe v1.49.0 works?\n\n```bash\nbun add @copilotkit/react-core@1.49.0 @copilotkit/runtime@1.49.0\n```\n\n**Result:** Different error. v1.49 doesn't have OpenRouter support.\n\n### Hour 4: Try Pre-release\n\nMaybe the fix is in beta?\n\n```bash\nbun add @copilotkit/react-core@next @copilotkit/runtime@next\n```\n\n**Result:** `next` tag doesn't exist. No beta channel.\n\n## The Moment of Truth\n\nIt's now 1:15 PM. I've been debugging for 4+ hours. I have two choices:\n\n**Option A: Wait for CopilotKit fix**\n\n* Unknown timeline (could be days, could be weeks)\n    \n* Blocks all feature development\n    \n* Keeps me dependent on a framework with a small team\n    \n\n**Option B: Rip out CopilotKit, migrate to a different AI SDK**\n\n* 2-3 hours of migration work (estimate)\n    \n* Back to working state by end of day\n    \n* Switch to more mature, actively maintained SDK\n    \n\nThe sunk cost fallacy is screaming at me: \"But you already spent 6 hours integrating CopilotKit! The cosmic UI is built around it! You'll have to rewrite everything!\"\n\n## The Decision Framework\n\nWhen frameworks fail you, ask these questions:\n\n### 1\\. Is this a configuration issue or a framework bug?\n\n**Answer:** Framework bug. Verified in source code and GitHub issues.\n\n### 2\\. Can I work around it?\n\n**Answer:** No. Tool execution is core to the product. Can't ship without it.\n\n### 3\\. Is a fix coming soon?\n\n**Answer:** Unknown. Issue is open with no milestone. Could be days, could be weeks.\n\n### 4\\. What's the migration cost?\n\n**Answer:** Estimated 2-3 hours. All the UI can stay. Just swap the chat hook and API route.\n\n### 5\\. What's the cost of waiting?\n\n**Answer:** Entire project blocked. Can't work on any subsequent slices.\n\n### 6\\. What's the opportunity cost?\n\n**Answer:** If I migrate now, I'm back to building features today. If I wait, I waste days in limbo.\n\n## The Pivot Decision\n\n1:47 PM. I make the call.\n\n**We're migrating to Vercel AI SDK.**\n\n### Why Vercel AI SDK?\n\n**Pros:**\n\n* ‚úÖ Industry standard (2M+ weekly npm downloads)\n    \n* ‚úÖ Maintained by Vercel (fast bug fixes, active development)\n    \n* ‚úÖ Official OpenRouter integration (`@openrouter/ai-sdk-provider`)\n    \n* ‚úÖ Comprehensive docs ([ai.sdk.dev](http://ai.sdk.dev), Academy courses, 50+ examples)\n    \n* ‚úÖ Better type safety (Zod schemas for tools)\n    \n* ‚úÖ Smaller bundle (95KB vs 180KB)\n    \n* ‚úÖ Next.js 16 optimized\n    \n\n**Cons:**\n\n* ‚ùå 2-3 hours of migration work\n    \n* ‚ùå Have to learn new API patterns\n    \n* ‚ùå Can't reuse CopilotKit-specific code\n    \n* ‚ùå Invalidates ADR-001 (previous architectural decision)\n    \n\n**Neutral:**\n\n* Same capabilities (tool calling, streaming, context)\n    \n* Lower-level API (more control but more code)\n    \n* No pre-built UI components (but I built custom UI anyway)\n    \n\n## The Emotional Side\n\nMaking this decision *sucked*.\n\nIt felt like admitting failure. I'd chosen CopilotKit carefully. I'd defended that choice in documentation. I'd built around it.\n\nBut here's the thing about solo development: **ego is expensive.**\n\nStubbornness has a cost measured in days. Being \"right\" about your initial framework choice doesn't matter if you can't ship.\n\n### The Mantra\n\nI wrote this in my notes:\n\n> \"Ship fast, pivot faster. The only unforgivable mistake is staying stuck.\"\n\nThen I started deleting code.\n\n## What I Learned\n\n**1\\. Framework lock-in is real**\n\nEven \"simple\" integrations create dependency trees that make migration painful.\n\n**2\\. Small teams = higher risk**\n\nCopilotKit is built by a small team. One breaking bug can block their entire user base for weeks.\n\n**3\\. GitHub Issues are underrated**\n\nI should've checked Issues *before* choosing the framework, not after it broke.\n\n**4\\. Community size matters**\n\nVercel AI SDK has 100x more users. More users = more eyes on bugs = faster fixes.\n\n**5\\. Sunk cost is a trap**\n\n4 hours of debugging is already lost. Don't lose 40 more hours to stubbornness.\n\n**6\\. \"By the book\" fails when the book is wrong**\n\nFollowing docs perfectly doesn't help when the framework has fundamental bugs.\n\n## The Commit That Closed This Chapter\n\n```bash\ncommit c59879c\nDate: Dec 26, 2025 - 2:03 PM\n\nchore: Add supporting files and configuration\n# Last commit before migration begins\n```\n\nBy 2:15 PM, I'd made the decision.\n\nBy 5:30 PM, the migration would be complete and tools would be working.\n\nBut that's a story for the next post.\n\n---\n\n## Technical Post-Mortem\n\n### What Went Wrong\n\n**Root Cause:** CopilotKit v1.50.1 has a bug where `appendMessage()` passes messages without the `isResultMessage()` method, but the runtime expects it.\n\n**Contributing Factors:**\n\n* Small framework team (slower response to bugs)\n    \n* No beta channel for testing pre-release fixes\n    \n* Deprecation handled poorly (new `sendMessage` API not fully working)\n    \n\n### Warning Signs I Missed\n\n1. **\"AI agents in 5 minutes\"** ‚Äî Too good to be true\n    \n2. **Small npm download count** ‚Äî Less than 10K/week\n    \n3. **Recent major version bump** ‚Äî v1.50 was only 2 weeks old\n    \n4. **Limited Stack Overflow presence** ‚Äî Few answered questions\n    \n\n### What I'd Do Differently\n\n1. **Check GitHub Issues before adoption** ‚Äî Open issues count matters\n    \n2. **Build POC before full integration** ‚Äî Test tool execution specifically\n    \n3. **Have migration plan from day one** ‚Äî \"If X breaks, we switch to Y\"\n    \n4. **Prefer boring technology** ‚Äî Established SDKs over promising new ones\n    \n\n---\n\n## Coming Next\n\nIn [Part 4: The Pivot](04-the-pivot-vercel-ai-sdk.md), I execute the migration.\n\nYou'll see:\n\n* The 3-hour migration process, step by step\n    \n* How Vercel AI SDK v6 actually works\n    \n* The moment tools finally executed\n    \n* What I learned about AI SDK architecture\n    \n* Why this crisis was the best thing that could've happened\n    \n\n**Spoiler:** By 5:30 PM, I had working tool execution. By 7:00 PM, I'd learned more about AI SDK internals than I would've in a month of \"happy path\" development.\n\nSometimes the best teachers are the frameworks that fail you.\n\n---\n\n**Commit References:**\n\n* `c59879c` - Last commit before migration (supporting files)\n    \n* `b7c72f3` - Complete Planning Phase P1 implementation with CopilotKit (broken)\n    \n\n**Files That Would Be Deleted:**\n\n* `/app/api/copilotkit/route.ts` - CopilotKit API route\n    \n* `/hooks/usePlanningTools.ts` - CopilotKit action hooks\n    \n* All imports from `@copilotkit/*`\n    \n\n**Debugging Tools Used:**\n\n* Chrome DevTools Network tab (watch API calls)\n    \n* Console.log debugging (tool handler invocation)\n    \n* CopilotKit source code (GitHub)\n    \n* GitHub Issues search (find known bugs)\n    \n\n**Time Spent:**\n\n* Debugging: 4+ hours\n    \n* Research/decision: 1 hour\n    \n* **Total sunk cost:** 5 hours\n    \n\n---\n\n**Previous:** [‚Üê Part 2: First Contact](02-first-contact-building-with-ai.md) **Next:** [Part 4: The Pivot ‚Üí](04-the-pivot-vercel-ai-sdk.md)",
  "brief": "Part 3: The Crisis - When Frameworks Fail\nPreviously: Built a beautiful chat interface with CopilotKit. Cosmic UI looking sharp. Memory system in place. Everything seems great.\nNow: Nothing works and I'm 4 hours into debugging hell.\nThe Morning After...",
  "author": "695abff5e4c04d1036cd307d",
  "sB": false,
  "isRepublished": false,
  "readTime": 8,
  "draft": "695ac7a932749f62b8bfb1dc",
  "tags": [
    "67200dcf65618dd1726b670c",
    "66ae032aa3a2a113838705d8",
    "56744721958ef13879b94b4d",
    "56744723958ef13879b95372",
    "56744721958ef13879b94db1",
    "6630c91191ab510b4c5a0e75"
  ],
  "publication": "695ac03d428b39bd40085e89",
  "isNewsletterActivated": true,
  "coAuthors": [],
  "dateUpdated": "2026-01-04T21:06:03.248Z",
  "hasCustomDate": false,
  "series": "695ac45c21b769e7641e57a5",
  "metaDescription": "CopilotKit broke. Tools wouldn't execute. Here's how I diagnosed the framework bug and made the hard decision to pivot. A lesson in sunk cost fallacy",
  "metaTitle": "When AI Frameworks Fail: My 4-Hour Debugging Nightmare | Part 3",
  "pollOptions": [],
  "badges": [],
  "questionReplies": [],
  "contributors": [],
  "uniqueReactions": [],
  "reactionToCountMapUnique": {
    "any": 1
  },
  "id": "695acb5a2df78b9097009068"
}